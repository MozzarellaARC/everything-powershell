
## Everything PowerShell (epwsh)

### ***This documentation is generated by AI, use it at your own risk.***

Minimal, fast PowerShell 7+ helpers for daily Windows dev/workstation life:

* Launch apps quickly (with Start Menu caching + executable fallback search)
* Jump to install directories
* Blazing fast file/dir search via [`fd`](https://github.com/sharkdp/fd)
* Manage environment variables sanely (`envs`)
* Bulk‑convert images (`imageto`)
* Jump shell to the topmost File Explorer folder (`cdx`)

Originally this project wrapped the Everything SDK. That integration was removed (keeping the name for continuity). All search now flows through `fd`.

---

## Contents
1. Goals & Philosophy
2. Features Overview
3. Installation
4. Commands & Usage
5. Examples (Quick Reference)
6. Implementation Notes
7. Deprecations
8. Contributing / Feedback
9. License

---

## 1. Goals & Philosophy
Keep common workstation actions fast, discoverable, low‑friction, and dependency‑light. Prefer one focused command over copy/paste or GUI hunting. Avoid heavy modules; ship as dot‑sourced scripts you can audit in seconds.

## 2. Features Overview
| Area | Command(s) | Highlights |
|------|------------|-----------|
| App launch & dir | `open`, alias `o` | Start Menu shortcut match first, else `fd` executable search in common roots; optional `-Dir` to open containing folder |
| App cache mgmt | `oget`, `oclear` | Automatic lazy caching of Start Menu `.lnk` targets |
| File search | `es` | `fd` wrapper: extensions, file/dir mode, multiple search paths, result limiting |
| Env vars | `envs` | List/inspect/set/append/refresh at Process/User/Machine scopes; easy PATH tokenization (`-Set`) |
| Image batch convert | `imageto` | Uses ImageMagick if available; otherwise safe .NET fallback (jpeg/png/gif/bmp/tiff) |
| Explorer -> shell | `cdx` | cd into the topmost Explorer window (quake friendly) |

## 3. Installation
Clone into your PowerShell profile directory (or anywhere, then dot‑source paths). Typical setup:

```pwsh
cd "$HOME/Documents/PowerShell"
git clone https://github.com/MozzarellaARC/everything-powershell.git .
# Ensure profile loads the scripts (already provided in repo profile example):
. $PROFILE   # reload after cloning
```

If you already have your own `Microsoft.PowerShell_profile.ps1`, copy or merge the dot‑sourcing lines:

```powershell
# Load opener functions
. "$PSScriptRoot\scripts\opwsh.ps1"

# Load Everything SDK wrapper
. "$PSScriptRoot\scripts\epwsh.ps1"

# Load ImageTools functions
. "$PSScriptRoot\scripts\imgpwsh.ps1"

# Auto cd to the foreground Windows Explorer folder
. "$PSScriptRoot\scripts\cdxpwsh.ps1"

# Load Environment Variable functions
. "$PSScriptRoot\scripts\envpwsh.ps1"

# Load Context Menu Override function
. "$PSScriptRoot\scripts\winapi_override.ps1"

# Initialize Headless Blender
. "$PSScriptRoot\scripts\init_pwsh.ps1"

# Batch Organization
. "$PSScriptRoot\scripts\repwsh.ps1"
```

### Required Dependency
`fd` must be on PATH for `open` (executable fallback) and `es`.

Install options:
```pwsh
# Scoop
scoop install fd

# or: winget
winget install Sharkdp.fd

# or: cargo
cargo install fd-find   # binary may be named 'fdfind'; alias to 'fd'
```

### Optional Dependency
ImageMagick (`magick.exe`) for advanced image formats in `imageto`:
```pwsh
winget install ImageMagick.ImageMagick
```

## 4. Commands & Usage

### open / o
```pwsh
open <name parts...>          # Launch by Start Menu name (substring, case-insensitive)
open -Dir <name>              # Open containing directory instead of launching
open vsc                      # Uses alias table (e.g. vsc -> Visual Studio Code)
```
If Start Menu lookup fails, falls back to an `fd` executable search over Program Files, Program Files (x86), LocalAppData, ProgramData. Interactive selection shown when multiple matches.

Aliases: `o` -> `open`

### App Cache
```pwsh
oget     # Force (re)scan Start Menu shortcuts (normally lazy automatically)
oclear   # Clear cached results
```

### es (fd wrapper)
```pwsh
es build                       # Plain search
es -ext ps1 -ext psd1 profile  # Multiple extensions
es -files readme               # Files only
es -dirs src                   # Directories only
es -path C:\Projects -path D:\Work build   # Constrain search roots
es -Limit 50 foo               # Limit results (default 200)
```
Outputs numbered results (0-based). This wrapper prints but does not open results automatically—pipe or copy as desired.

### envs
Unified environment variable helper.
```pwsh
envs                   # All variables (Process, User, Machine)
envs User              # All user vars
envs Path User         # Get user PATH
envs TOOLS_HOME User 'C:\Tools' -Set -Refresh   # Create var & add %TOOLS_HOME% to PATH
envs Path User 'C:\ExtraBin' -Append -Refresh   # Append directory to PATH
envs MY_TEMP Process 123                         # Simple process var
```
Key switches: `-Set` (set var then add token to PATH), `-Append`, `-Refresh` (sync current session after User/Machine mutations), `-Help`.

### imageto
```pwsh
imageto webp            # Convert all images in cwd to .webp (needs ImageMagick)
imageto png -Recurse    # Recurse into subfolders
imageto jpeg . -Force   # Force overwrite (otherwise deduplicates with -1, -2 suffix)
```
Without ImageMagick only basic formats convert (jpeg/png/gif/bmp/tiff). Skips unsupported inputs with a warning.

### cdx
```pwsh
cdx              # cd into topmost File Explorer directory
cdx -PassThru    # Also emit the path object
```
Great with Windows Terminal quake mode—finds the Explorer window just beneath.

## 5. Examples (Quick Reference)
```pwsh
open chrome
open -Dir firefox
open vsc

es -ext ps1 profile
es -dirs -path C:\Repos build

envs TOOLS_HOME User 'C:\Tools' -Set -Refresh
envs Path User 'C:\ExtraBin' -Append -Refresh

imageto png -Recurse
cdx
```

## 6. Implementation Notes
High level flow for `open`:
1. Build (or reuse) cached Start Menu map of `.lnk` -> target path (two well-known roots).
2. Substring match on display names (case-insensitive). Single match launches directly; multiple -> interactive menu.
3. If zero Start Menu hits: fallback to `fd` searching for `*.exe` under curated roots; interactive selection if >1.
4. `-Dir` switch opens the containing folder instead of launching.
5. Before launching a Start Menu match, tries to foreground an already-running window with process heuristics.

Search root order (executables): Program Files, Program Files (x86), LocalAppData, ProgramData.

## 7. Deprecations
Removed: Everything SDK integration (replaced fully by `fd`).
Legacy / kept for now: older `open-dir` alias name (prefer `open -Dir`). The function `oref` formerly forced refresh and is no longer needed.

## 8. Contributing / Feedback
Spotted an edge case? Want another tiny focused helper? PRs and issues welcome.

Guiding principles for additions:
* Single clear purpose
* Minimal external deps
* Fast to read + audit
* Aligns with Windows dev workflow

## 9. License
See `LICENSE`.
